"use strict";(self.webpackChunkdocs_test=self.webpackChunkdocs_test||[]).push([[473],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=i.createContext({}),c=function(e){var t=i.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(d.Provider,{value:t},e.children)},l="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,d=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),l=c(n),m=o,h=l["".concat(d,".").concat(m)]||l[m]||u[m]||r;return n?i.createElement(h,a(a({ref:t},p),{},{components:n})):i.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=m;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s[l]="string"==typeof e?e:o,a[1]=s;for(var c=2;c<r;c++)a[c]=n[c];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5665:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var i=n(7462),o=(n(7294),n(3905));const r={},a="Location Permission & Notifications Best Practices",s={unversionedId:"Point SDK/Android/Location Permission & Notifications Best Practices",id:"Point SDK/Android/Location Permission & Notifications Best Practices",title:"Location Permission & Notifications Best Practices",description:"Location permissions",source:"@site/docs/Point SDK/Android/Location Permission & Notifications Best Practices.md",sourceDirName:"Point SDK/Android",slug:"/Point SDK/Android/Location Permission & Notifications Best Practices",permalink:"/documentation/Point SDK/Android/Location Permission & Notifications Best Practices",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Enable or disable Zones",permalink:"/documentation/Point SDK/Android/Features/Enable or disable zones"},next:{title:"Best Practices & Recommendations",permalink:"/documentation/Point SDK/Android/Best Practices & Recommendations"}},d={},c=[{value:"Location permissions",id:"location-permissions",level:2},{value:"Foreground service and persistent notification",id:"foreground-service-and-persistent-notification",level:2}],p={toc:c},l="wrapper";function u(e){let{components:t,...r}=e;return(0,o.kt)(l,(0,i.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"location-permission--notifications-best-practices"},"Location Permission & Notifications Best Practices"),(0,o.kt)("h2",{id:"location-permissions"},"Location permissions"),(0,o.kt)("p",null,"Prior to starting any Bluedot Services (Geo-triggering or Tempo), the app must request and be granted location permission. When requesting location permission it is important to make the request in context and convey the value the user will be gaining from granting the permission."),(0,o.kt)("p",null,"For apps targeted Android 11 and lower, only ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/reference/android/Manifest.permission#ACCESS_FINE_LOCATION"},"ACCESS_FINE_LOCATION")," permission needs to be requested and granted."),(0,o.kt)("p",null,"When targeting Android 12 and onwards the app must request both ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/location/permissions#request-location-access-runtime"},"approximate location")," and ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/location/permissions#accuracy"},"precise location"),". The app should request ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/reference/android/Manifest.permission#ACCESS_COARSE_LOCATION"},"ACCESS_COARSE_LOCATION")," and ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/reference/android/Manifest.permission#ACCESS_FINE_LOCATION"},"ACCESS_FINE_LOCATION"),"."),(0,o.kt)("p",null,"The user may choose to grant access to either approximate or precise as shown below:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(6784).Z,width:"146",height:"300"})),(0,o.kt)("p",null,"If the app has not been granted permission to access precise location data the Geo-triggering and Tempo services will not start, and the start method will return a ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point/-location-permission-not-granted-error/index.html"},"LocationPermissionNotGrantedError"),". To ensure the location permission has been granted, it is important to implement the permission checking and requesting process prior to any attempt to start a Bluedot service."),(0,o.kt)("p",null,"Additionally, from Android 10 onwards, if the Geo-triggering service is not run as a ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/guide/components/foreground-services"},"foreground service"),", the ",(0,o.kt)("inlineCode",{parentName:"p"},"ACCESS_BACKGROUND_LOCATION")," ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/location/permissions#background"},"permission must be requested")," and granted in order for the Geo-triggering service to access location data and function when the app is not in use. From Android 11 onwards, the request to access background location data ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/about/versions/11/privacy/location#request-background-location-separately"},"must be made separately")," from the initial request to access location data. Even when granted permission to access background location data the access is limited to only a ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/location/background#limit-updates"},"few updates per hour")," while the app is not in use. The Play Store also has ",(0,o.kt)("a",{parentName:"p",href:"https://support.google.com/googleplay/android-developer/answer/9799150"},"restrictions")," on how apps published on the store may utilise background location data."),(0,o.kt)("h2",{id:"foreground-service-and-persistent-notification"},"Foreground service and persistent notification"),(0,o.kt)("p",null,"Given the restrictions on accessing location data from the background, it is recommended that the Geo-triggering service be run as a foreground service, and the Tempo service must be run as a foreground service. Implementing a ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/guide/components/foreground-services"},"foreground service")," is the best practice for ensuring users are fully aware of how and when their location is accessed and also for the most efficient use of system resources. When a foreground service is running, there will be a persistent notification in the notification tray informing the user that your app is accessing the device location when the app is in the foreground and background.\xa0Foreground services must always be started while the app is in use and in the foreground."),(0,o.kt)("p",null,"To run as a foreground service the ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-geo-triggering-service/-geo-trigger-builder/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"GeoTriggerBuilder"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-tempo-service/-tempo-builder/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"TempoBuilder"))," must be passed a ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/notify-user/build-notification"},"Notification")," via the ",(0,o.kt)("inlineCode",{parentName:"p"},"notification()")," method. This is the notification that will be displayed persistently as long as the service is running. The notification should convey to the user why the app is collecting location data, and what value they are receiving from allowing the app to do so."),(0,o.kt)("p",null,"Please see our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Bluedot-Innovation/PointSDK-MinimalIntegrationExample-Android"},"Minimal Integration")," project for examples on how to build notifications and start ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Bluedot-Innovation/PointSDK-MinimalIntegrationExample-Android/blob/415b25f55e551718fd4525858f3db9346920f802/app/src/main/java/au/com/bluedot/minimalintegration/MainApplication.java#L93"},"Geo-triggering")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Bluedot-Innovation/PointSDK-MinimalIntegrationExample-Android/blob/415b25f55e551718fd4525858f3db9346920f802/app/src/main/java/au/com/bluedot/minimalintegration/MainApplication.java#L120"},"Tempo")," as foreground services."),(0,o.kt)("p",null,"If a notification is passed in during Geo-triggering or Tempo initialization, the notification will be displayed across all device OS versions.\xa0 To only display the notification on devices running Android Oreo and above, where it is required to access location data from the background, perform a version check when initializing the service and pass in notification only if the OS version is API level 26 or above:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n     GeoTriggeringService.builder()\n        .notification(notification)\n        .start(this, geoTriggerError -> {\n            // Call method to handle Geo-triggering initialization here.\n        });\n } else {\n     GeoTriggeringService.builder()\n        .start(this, geoTriggerError -> {\n            // Call method to handle Geo-triggering initialization here.\n        });\n }\n")),(0,o.kt)("p",null,"If your app runs another foreground service or will run the Geo-triggering service and Tempo service simultaneously, it is best practice to use the same notification ID. Using the same notification ID ensures that only a single persistent notification will be displayed for all running foreground services. The ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-geo-triggering-service/-geo-trigger-builder/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"GeoTriggerBuilder"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-tempo-service/-tempo-builder/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"TempoBuilder"))," expose ",(0,o.kt)("inlineCode",{parentName:"p"},"notificationId()")," methods to set the ",(0,o.kt)("inlineCode",{parentName:"p"},"notification ID"),", and the ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-geo-triggering-service/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"GeoTriggeringService"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://android-docs.bluedot.io/-bluedot-s-d-k/au.com.bluedot.point.net.engine/-tempo-service/index.html"},(0,o.kt)("inlineCode",{parentName:"a"},"TempoService"))," expose the notification ID in use via ",(0,o.kt)("inlineCode",{parentName:"p"},"foregroundNotificationId()")," methods. The notification ID may be used to ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/notify-user/build-notification#Updating"},"update the notification")," after starting a service. Be aware that the most recent notification used to start a service, or the last update, will be displayed as long as any foreground service is running, thus it may be necessary to update the notification when stopping service to ensure the content remains correct."),(0,o.kt)("p",null,"If you do not plan to use location services without a foreground service, it\u2019s recommended that you remove the background location permission entry included in the SDK Manifest.\xa0The Bluedot SDK will continue to receive location even when the app is backgrounded without this permission so long as the foreground notification is visible. Removing this Manifest entry can help to minimise Play Store review concerns. You can do this by adding to your app\u2019s Manifest:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml",metastring:'title="AndroidManifest"',title:'"AndroidManifest"'},'<uses-permission\n    android:name="android.permission.ACCESS_BACKGROUND_LOCATION"\n    tools:node="remove"\n/>\n')),(0,o.kt)("p",null,"Services running\xa0in the background consume device resources such as battery life, CPU time and memory, potentially resulting in bad user experiences. To mitigate this problem, since the Oreo release of the Android operating system, \xa0a number of limitations have been applied to the operation of background services. Android 12 also added new restrictions for apps targeting Android 12 (API level 31) onwards. Most significantly, there are further restrictions on the ability to start ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/guide/components/foreground-services"},"foreground")," services while running in the background, except for ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/about/versions/12/foreground-services#cases-fgs-background-starts-allowed"},"a few special cases"),"."))}u.isMDXComponent=!0},6784:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/FlR1TT9c-146x300-03f09f4393ee82c1cc957fe19f80e70b.png"}}]);